<html lang="en">
<head>
  <title>Sudoku</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0"/>
</head>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>
<script src="https://d3js.org/d3-hsv.v0.1.min.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.16.3/math.min.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script> -->
<!-- <script type="text/x-mathjax-config"> MathJax.Hub.Config({ extensions: ["tex2jax.js"], jax: ["input/TeX","output/HTML-CSS"], tex2jax: { inlineMath: [["\\(","\\)"]] } }); </script> -->
<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script> -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.1/dat.gui.min.js"></script> -->
<!-- <script src="https://unpkg.com/sweetalert2@7.13.3/dist/sweetalert2.all.js"></script> -->

<link rel="stylesheet" href="../css/style.css">
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> -->
<!-- <link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet"> -->

<script src = '../js/sudoku.js'></script>
<script src = '../js/cells.js'></script>
<script src = '../js/controls.js'></script>
<script src = '../js/update.js'></script>

<body>
  <div class = 'fluid-container text-center'>
    <h5 class = 'py-3 text-secondary'>Sudoku</h5>
    <svg id = 'canvas'></svg>
  </div>
</body>

<script>

Array.prototype.last = function(){
  return this[ this.length-1 ]
}

// ************************************************************************************** //
// Canvas variables

var data_cells = [];
for(var i = 1; i <= 9; i++){
  for(var j = 1; j <= 9; j++){
    var temp_x_pos = parseInt((i-1)/3);
    var temp_y_pos = parseInt((j-1)/3);
    var temp_square_pos = temp_x_pos*3 + temp_y_pos;
    var temp_id = (i-1)*9 + j;

    var temp_object = { x: i, y: j, square: temp_square_pos, id: temp_id, fixed: false, value: null, selected: false, highlighted: false, guesses: [] };
    data_cells.push(temp_object);
  }
}

// ************************************************************************************** //
// Preparing the board

var canvas_width = 500, canvas_height = 800;
var canvas_size = 400;
d3.select('#canvas').styles({ width: canvas_width, height: canvas_height });

var current_active_cell = null;
var highlighting_allowed = false, current_highlighting_value = null;
var guess_on = false, show_possibilities = false;

var user_data = [];
function push_data(){
  // var temp_data = data_cells.map(d => { return( jQuery.extend(true, {}, d) ) });
  var temp_data = data_cells.map(d => { return d.value });
  user_data.push(temp_data);
}

function pop_data(){
  if(user_data.length > 1){
    user_data.pop();
    // data_cells = user_data.last().map(d => { return( jQuery.extend(true, {}, d) ) });
    var temp_arr = user_data.last();
    data_cells.forEach( (d,i) => { d.value = temp_arr[i]; } )
    current_active_cell = null; current_highlighting_value = null;
    update();
  }
}

var box_size = canvas_size/9;
createBoard();

var data_controls = [];
createControls();

var temp_num_list = d3.range(sudoku_archive.length);
function select_sudoku(){
  var temp_num = math.randomInt(temp_num_list.length);
  assignSudoku( sudoku_archive[ temp_num_list[temp_num] ] );
  temp_num_list.splice(temp_num, 1);
  if(temp_num_list.length == 0){ temp_num_list = d3.range(sudoku_archive.length); }
  user_data = []; push_data();
}

function reset(){
  while(user_data.length > 1){ user_data.pop(); }
  // data_cells = user_data.last().map(d => { return( jQuery.extend(true, {}, d) ) });
  var temp_arr = user_data.last();
  data_cells.forEach( (d,i) => { d.value = temp_arr[i]; } )
  current_active_cell = null; current_highlighting_value = null;
  update();
}

select_sudoku();
update();

create_Events_for_Cells();
createControls_Events();

</script>
